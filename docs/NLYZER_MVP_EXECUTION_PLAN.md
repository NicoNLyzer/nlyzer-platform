# NLyzer MVP Execution Plan

**From Grand Vision to Commercial Reality**

*Last Updated: 2025-08-02*  
*Status: MVP Implementation Guide*

---

## The Development Workflow: The Founder & The AI-PM

This execution plan will be implemented using a structured, AI-assisted workflow.

**The Founder (CEO):** My role is to act as the high-level project manager. I will make the strategic decisions, manage the timeline, and initiate each step of this plan by referring to its Sprint and Step number (e.g., "Begin Sprint 1, Step 1.1"). I am responsible for testing the AI-generated code and providing the final approval (the Git commit hash) upon successful completion.

**The AI Project Manager (AI-PM):** This is the role fulfilled by the primary AI assistant (in Google AI Studio). Its job is to read this execution plan, manage the Git branching strategy, generate the high-caliber technical prompts for the AI Developer, and maintain the CHANGELOG.md.

**The AI Developer:** This is the role fulfilled by the code-specific AI assistant (e.g., Claude Code). Its job is to execute the technical prompts generated by the AI-PM.

### The Git-Flow Mandate (Test-Driven)

You MUST manage every development task using this exact sequence:

1. **Branch Creation:** When I ask to start a new task, your FIRST action is to provide the `git checkout -b feature/...` command.
2. **Logic Prompt Generation:** After I confirm, you will generate the technical prompt for the AI Developer to build the application code.
3. **Test Prompt Generation:** Immediately after generating the logic prompt, you will generate a SECOND technical prompt for the AI Developer to build the unit tests for that application code.
4. **Verification via Testing:** I will get both the logic and the tests built. My primary verification step will be to run the tests using the `just test-api` command.
5. **Changelog Generation:** Only after the tests pass and I provide you with the Git commit hash will you generate the detailed entry for the `CHANGELOG.md`.

---

## Part 1: MVP Architectural Diagram

```
                                    NLYZER MVP: SCOPED BUSINESS PROCESS FLOW
                                          ONLY ESSENTIAL COMPONENTS FOR COMMERCIAL VIABILITY
                                                                          
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                             CUSTOMER ACQUISITION LAYER                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────┐         ┌────────────────────────────────┐         ┌────────────────────────────────┐
│      MARKETING WEBSITE         │   ────> │         SIGNUP FORM            │   ────> │       STRIPE PAYMENT          │
│                                │         │                                │         │                                │
│ MVP Frontend Stack:            │         │ MVP Form Components:           │         │ MVP Payment Stack:             │
│ • Next.js 14 + TypeScript      │         │ • BusinessDetailsForm.tsx     │         │ • Stripe Elements React       │
│ • TailwindCSS (basic styles)   │         │ • EcommercePlatformSelect.tsx  │         │ • stripe-js library           │
│ • Static pages only            │         │ • PlanSelectionCards.tsx      │         │ • webhook endpoint validation  │
│ [POST-MVP] Framer Motion       │         │ [POST-MVP] TrafficEstimate     │         │                                │
│ [POST-MVP] Vercel Edge Funcs   │         │                                │         │ MVP Form Fields:               │
│                                │         │ MVP Validation:                │         │ • Credit Card (Elements)       │
│ MVP UI Components:             │         │ • Zod schema validation        │         │ • Billing Address              │
│ • HeroSection.tsx             │         │ • Real-time field validation   │         │ • Subscription Tier            │
│ • FeatureShowcase.tsx         │         │ • Business email verification  │         │ [POST-MVP] Promo Code         │
│ • PricingTable.tsx            │         │ [POST-MVP] Platform API test   │         │                                │
│ [POST-MVP] Testimonials       │         │                                │         │ MVP Plans & Pricing:           │
│ [POST-MVP] Demo Video         │         │ MVP Required Fields:           │         │ • Basic: $99/month             │
│                                │         │ • Business Name                │         │ • Pro: $299/month              │
│ MVP Hosting & CDN:             │         │ • Contact Email                │         │ [POST-MVP] Enterprise         │
│ • Vercel deployment           │         │ • Platform Type (Shopify only) │         │ [POST-MVP] Custom pricing     │
│ [POST-MVP] Global Edge        │         │ • Plan Selection               │         │                                │
│ [POST-MVP] Image optimization │         │ [POST-MVP] Product Count       │         │ MVP Stripe Integration:        │
│ [POST-MVP] Core Web Vitals    │         │ [POST-MVP] Traffic Volume      │         │ • sk_live_... (secret key)     │
│                                │         │ [POST-MVP] AI Agent Prefs     │         │ • pk_live_... (publishable)    │
│ MVP Analytics & SEO:           │         │ [POST-MVP] Industry Vertical   │         │ • Webhook Secret validation    │
│ • Google Analytics 4          │         │ [POST-MVP] Business Size       │         │ • Basic subscription mgmt      │
│ [POST-MVP] Google Tag Manager │         │                                │         │                                │
│ [POST-MVP] OpenGraph tags     │         │ MVP API Endpoint:              │         │ MVP API Endpoints:             │
│ [POST-MVP] Schema.org data    │         │ • POST /api/signup             │         │ • POST /api/payments/create    │
│ [POST-MVP] Sitemap generation │         │ • Request validation           │         │ • POST /api/webhooks/stripe    │
│                                │         │ • Database record creation     │         │ [POST-MVP] Subscriptions mgmt │
│ MVP Domain & SSL:              │         │                                │         │                                │
│ • nlyzer.com (primary)        │         │ MVP State Management:          │         │ MVP Payment Flow:              │
│ • SSL certificate (Let's Encrypt)│       │ • React Context for form      │         │ • Payment Intent creation      │
│ [POST-MVP] Cloudflare DNS     │         │ • localStorage for draft       │         │ • 3D Secure authentication    │
│                                │         │ [POST-MVP] Session persist    │         │ • Basic provisioning trigger  │
└────────────────────────────────┘         └────────────────────────────────┘         └────────────────────────────────┘
                                                                                                          │
                                                                                                          │
                                                                                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                               CONTROL PLANE API (nlyzer-control-plane project)                                                            │
│                                     Service Account: nlyzer-api@nlyzer-control-plane.iam.gserviceaccount.com                            │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────┐         ┌────────────────────────────────┐         ┌────────────────────────────────┐
│    AUTHENTICATION & VALIDATION │   ────> │      CUSTOMER DATA STORAGE     │   ────> │     PROVISIONING REQUEST       │
│                                │         │                                │         │                                │
│ MVP FastAPI Service:           │         │ MVP PostgreSQL Database:       │         │ MVP Pub/Sub Publisher:         │
│ • main.py (app entry point)    │         │ • Database: nlyzer_control     │         │ • Topic: provisioning-requests │
│ • Port: 8000                   │         │ • Host: Cloud SQL instance     │         │ • Message Schema: TenantConfig  │
│ • Basic auth only              │         │ • Connection Pool: asyncpg     │         │ • Publisher Service Account    │
│                                │         │                                │         │                                │
│ MVP API Endpoints:             │         │ MVP Database Tables:           │         │ MVP Message Contents:          │
│ • POST /api/auth/signup        │         │ • tenants (id, name, status)   │         │ • tenant_id: UUID              │
│ [POST-MVP] /api/auth/login     │         │ • subscriptions (tier, status) │         │ • business_name: string        │
│ [POST-MVP] /api/auth/me        │         │ [POST-MVP] api_keys            │         │ • platform_type: shopify       │
│ [POST-MVP] /api/auth/refresh   │         │ • billing_info (stripe_data)   │         │ • subscription_tier: string    │
│                                │         │ [POST-MVP] audit_logs          │         │ • shopify_credentials: encrypted│
│ MVP Authentication Stack:      │         │                                │         │ [POST-MVP] agent_config        │
│ • Basic JWT token generation   │         │ MVP SQLAlchemy Models:         │         │ [POST-MVP] custom_domain       │
│ • Pydantic input validation    │         │ • nlyzer/db/models/tenant.py   │         │                                │
│ • FastAPI dependency injection │         │ • nlyzer/db/models/user.py     │         │ MVP Python Script:             │
│ [POST-MVP] OAuth2 bearer      │         │ • nlyzer/db/models/billing.py  │         │ • nlyzer/api/provisioning.py  │
│                                │         │ [POST-MVP] audit.py            │         │ • publish_provisioning_request()│
│ MVP Security Middleware:       │         │                                │         │ • generate_tenant_config()     │
│ • CORS configuration           │         │ MVP Database Operations:       │         │ [POST-MVP] validate_data       │
│ • Rate limiting (basic)        │         │ • nlyzer/db/crud/tenant.py     │         │                                │
│ • Input sanitization          │         │ • nlyzer/db/crud/user.py       │         │ MVP Topic Configuration:       │
│ [POST-MVP] SQL injection prev │         │ • nlyzer/db/crud/billing.py    │         │ • Retention: 7 days            │
│ [POST-MVP] XSS protection     │         │ [POST-MVP] Connection pooling  │         │ [POST-MVP] Dead letter queue   │
│                                │         │ [POST-MVP] Transaction mgmt    │         │ [POST-MVP] Message ordering    │
│ MVP Business Logic:            │         │                                │         │ [POST-MVP] Retry policy        │
│ • nlyzer/agents/onboarding.py  │         │ MVP Encryption & Security:     │         │                                │
│ • validate_business_profile()  │         │ • Basic password hashing       │         │ MVP Monitoring:                │
│ [POST-MVP] platform_compat     │         │ [POST-MVP] AES-256 for keys   │         │ • Basic message publish metrics│
│ [POST-MVP] resource_needs      │         │ [POST-MVP] Field encryption   │         │ [POST-MVP] Dead letter alerts │
│ • generate_tenant_config()     │         │ [POST-MVP] Audit trail        │         │ [POST-MVP] Status tracking     │
│                                │         │                                │         │                                │
│ MVP Service Account IAM:       │         │ MVP Backup & Recovery:         │         │ MVP Error Handling:            │
│ • secretmanager.secretAccessor │         │ • Automated daily backups      │         │ • Validation error responses   │
│ • pubsub.publisher             │         │ [POST-MVP] Point-in-time       │         │ • Basic business logic exceptions│
│ • cloudsql.client              │         │ [POST-MVP] Cross-region        │         │ [POST-MVP] Pub/Sub failures   │
│ • logging.logWriter            │         │ [POST-MVP] 30-day retention    │         │ [POST-MVP] Rollback on fail   │
└────────────────────────────────┘         └────────────────────────────────┘         └────────────────────────────────┘
                                                                                                          │
                                                                                                          │
                                                                                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                          AUTOMATED PROVISIONING PIPELINE                                                                   │
│                              Service Account: nlyzer-provisioner@nlyzer-control-plane.iam.gserviceaccount.com                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────┐    ┌──────────────────────┐    ┌──────────────────────┐    ┌──────────────────────┐    ┌──────────────────────┐
│ PROVISIONING TRIGGER │────│  GCP PROJECT CREATE  │────│     IAM SETUP        │────│  SECRETS MANAGEMENT  │────│   ENABLE APIS        │
│                      │    │                      │    │                      │    │                      │    │                      │
│ MVP Cloud Function:  │    │ MVP GCP Client:      │    │ MVP GCP Client:      │    │ MVP GCP Client:      │    │ MVP GCP Client:      │
│ • Function Name:     │    │ • resourcemanager_v3 │    │ • iam_admin_v1       │    │ • secretmanager      │    │ • serviceusage_v1    │
│   provision-tenant   │    │ • ProjectsClient()   │    │ • IAMClient()        │    │ • SecretManagerService│    │ • ServiceUsageClient │
│ • Runtime: Python 3.11│   │                      │    │                      │    │   Client()           │    │                      │
│ • Memory: 2GB        │    │ MVP Python Function: │    │ MVP Python Function: │    │                      │    │ MVP Required APIs:   │
│ • Timeout: 540s      │    │ • _create_gcp_project│    │ • _create_service_   │    │ MVP Python Function: │    │ • compute.googleapis │
│                      │    │   (tenant_id, config)│    │   account()          │    │ • _store_tenant_     │    │ • run.googleapis     │
│ MVP Trigger:         │    │                      │    │ [POST-MVP] configure │    │   secrets()          │    │ • secretmanager      │
│ • Pub/Sub Topic:     │    │ MVP Project Gen:     │    │   _iam_permissions() │    │ [POST-MVP] create_   │    │ [POST-MVP] storage   │
│   provisioning-      │    │ • Project ID:        │    │                      │    │   secret_versions()  │    │ [POST-MVP] registry  │
│   requests           │    │   nlyzer-tenant-     │    │ MVP Service Accounts:│    │                      │    │ [POST-MVP] build     │
│                      │    │   {tenant-id}-       │    │ • nlweb-{tenant}@    │    │ MVP Secrets Created: │    │ [POST-MVP] resource  │
│ MVP Event Handler:   │    │   {random-suffix}    │    │   {project}.iam...   │    │ • tenant-shopify-    │    │ [POST-MVP] iam       │
│ • functions_framework │    │ • Display Name:      │    │ [POST-MVP] weaviate  │    │   api-key            │    │ [POST-MVP] billing   │
│ • cloud_event        │    │   "NLyzer Tenant     │    │   service account    │    │ • tenant-openai-key  │    │                      │
│                      │    │   {business_name}"   │    │                      │    │ [POST-MVP] stripe    │    │ MVP API Enablement:  │
│ MVP Message Process: │    │ • Labels:            │    │ MVP IAM Roles:       │    │ [POST-MVP] custom    │    │ • batch_enable_      │
│ • parse_tenant_config│    │   - tenant-id        │    │ • storage.objectViewer│    │   domain secrets     │    │   services()         │
│ [POST-MVP] validate  │    │   - environment: prod│    │ • secretmanager.     │    │                      │    │ [POST-MVP] wait_op   │
│ • orchestrate_       │    │   - managed-by       │    │   secretAccessor     │    │ MVP Encryption:      │    │ [POST-MVP] verify    │
│   provisioning()     │    │                      │    │ • logging.logWriter  │    │ • Basic encryption   │    │                      │
│                      │    │ MVP Billing Config:  │    │ [POST-MVP] monitoring│    │ [POST-MVP] AES-256   │    │ MVP Dependencies:    │
│ MVP Error Handling:  │    │ • Link billing       │    │ [POST-MVP] pubsub    │    │ [POST-MVP] Auto rot  │    │ • Basic API checks   │
│ • retry_on_failure   │    │   account            │    │                      │    │ [POST-MVP] Versioning│    │ [POST-MVP] Chain val │
│ [POST-MVP] cleanup   │    │ [POST-MVP] Budget    │    │ MVP Security:        │    │                      │    │ [POST-MVP] Deps      │
│ [POST-MVP] failure   │    │ [POST-MVP] Cost      │    │ • Basic access control│   │                      │    │                      │
│   notification       │    │   tracking           │    │ [POST-MVP] Conditional│    │                      │    │                      │
└──────────────────────┘    └──────────────────────┘    └──────────────────────┘    └──────────────────────┘    └──────────────────────┘
                                                                                                                      │
                                                                                                                      │
                                                                                                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                            INFRASTRUCTURE DEPLOYMENT                                                                       │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────┐    ┌──────────────────────┐    ┌──────────────────────┐    ┌──────────────────────┐    ┌──────────────────────┐
│   [POST-MVP]         │────│  NLWEB DEPLOYMENT    │────│  BASIC NETWORKING    │────│   CONFIG STORAGE     │────│  [POST-MVP]          │
│   VECTOR DATABASE    │    │                      │    │                      │    │                      │    │  LOAD BALANCER       │
│                      │    │ MVP Cloud Run:       │    │ MVP VPC Config:      │    │ MVP Cloud Storage:   │    │                      │
│ [POST-MVP] Weaviate │    │ • Service Name:      │    │ • Default VPC only   │    │ • Bucket Name:       │    │ [POST-MVP] Cloud LB  │
│ [POST-MVP] on GCE    │    │   nlweb-{tenant-id}  │    │ [POST-MVP] Custom VPC│    │   config-{tenant-id} │    │ [POST-MVP] HTTPS     │
│ [POST-MVP] Instance  │    │ • Region: us-central1│    │ [POST-MVP] Subnet    │    │ • Location: us-central1│   │ [POST-MVP] Backend   │
│ [POST-MVP] Machine   │    │ • Min Instances: 0   │    │ [POST-MVP] CIDR      │    │ • Storage Class:     │    │ [POST-MVP] SSL Cert  │
│ [POST-MVP] Zone      │    │ • Max Instances: 10  │    │                      │    │   STANDARD           │    │                      │
│                      │    │                      │    │ MVP Firewall Rules:  │    │                      │    │ [POST-MVP] Health    │
│ [POST-MVP] Container │    │ MVP Container Config:│    │ • Basic allow-all    │    │ MVP Configuration:   │    │ [POST-MVP] Checks    │
│ [POST-MVP] Image     │    │ • Image: gcr.io/     │    │ [POST-MVP] Specific  │    │ • nlweb_config.yml   │    │ [POST-MVP] Interval  │
│ [POST-MVP] Port      │    │   {project}/nlweb-   │    │   weaviate rules     │    │ [POST-MVP] startup   │    │ [POST-MVP] Timeout   │
│ [POST-MVP] Volume    │    │   extension:latest   │    │ [POST-MVP] Target    │    │ [POST-MVP] require   │    │ [POST-MVP] Threshold │
│                      │    │ • Port: 8000         │    │ [POST-MVP] Protocol  │    │ [POST-MVP] Dockerfile│    │                      │
│ [POST-MVP] Env Vars  │    │ • CPU: 2 vCPU        │    │                      │    │                      │    │ [POST-MVP] URL Map   │
│ [POST-MVP] WEAVIATE  │    │ • Memory: 4 GiB      │    │ MVP Network Security:│    │ MVP Template Gen:    │    │ [POST-MVP] Cloud Run │
│ [POST-MVP] HOST      │    │                      │    │ • Basic private      │    │ • Basic Jinja2       │    │ [POST-MVP] API routes│
│ [POST-MVP] PORT      │    │ MVP Environment Vars:│    │   Google Access     │    │   templates          │    │ [POST-MVP] Static    │
│ [POST-MVP] PERSIST   │    │ • [POST-MVP] WEAVIATE│    │ [POST-MVP] Cloud NAT │    │ • Basic config       │    │                      │
│                      │    │ • GCP_PROJECT_ID=    │    │ [POST-MVP] VPC peer  │    │ • Secret references  │    │ [POST-MVP] Custom    │
│ [POST-MVP] Startup   │    │   {tenant-project}   │    │                      │    │ [POST-MVP] Resource  │    │ [POST-MVP] Domain    │
│ [POST-MVP] install   │    │ • CONFIG_BUCKET=     │    │ MVP IAM Networking:  │    │   limits             │    │ [POST-MVP] DNS verify│
│ [POST-MVP] configure │    │   config-{tenant}    │    │ • Basic network      │    │                      │    │ [POST-MVP] SSL prov  │
│ [POST-MVP] setup     │    │ • OPENAI_API_KEY=    │    │   admin role         │    │ MVP File Structure:  │    │ [POST-MVP] Cert renew│
│ [POST-MVP] enable    │    │   ${SECRET_REF}      │    │ [POST-MVP] Security  │    │ • config/            │    │                      │
│                      │    │                      │    │ [POST-MVP] Compute   │    │   ├── base.yml       │    │ [POST-MVP] Traffic   │
│ [POST-MVP] Backup    │    │ MVP Service Account: │    │                      │    │   ├── {tenant}.yml   │    │ [POST-MVP] Blue-green│
│ [POST-MVP] Daily     │    │ • nlweb-{tenant}@    │    │ [POST-MVP] Monitoring│    │   └── templates/     │    │ [POST-MVP] Canary    │
│ [POST-MVP] 30-day    │    │   {project}.iam...   │    │ [POST-MVP] VPC Flow  │    │                      │    │ [POST-MVP] A/B test  │
│ [POST-MVP] Cross-reg │    │                      │    │ [POST-MVP] Firewall  │    │ MVP Access Control:  │    │                      │
│                      │    │ MVP Scaling Config:  │    │ [POST-MVP] Network   │    │ • Service account    │    │ [POST-MVP] Error     │
│ [POST-MVP] Health    │    │ • CPU utilization:70%│    │   telemetry          │    │   read access        │    │ [POST-MVP] Pages     │
│ [POST-MVP] Endpoint  │    │ • Concurrency: 80    │    │                      │    │ [POST-MVP] Versioned │    │ [POST-MVP] 502       │
│ [POST-MVP] Interval  │    │ • Request timeout:300s│   │ [POST-MVP] Security  │    │ [POST-MVP] Lifecycle │    │ [POST-MVP] 503       │
│ [POST-MVP] Restart   │    │                      │    │   Groups default     │    │                      │    │ [POST-MVP] 504       │
│                      │    │ MVP Container Reg:   │    │ [POST-MVP] tenant    │    │ [POST-MVP] Backup    │    │                      │
│ [POST-MVP] Perf      │    │ • Base Image:        │    │   allow nlweb        │    │ [POST-MVP] Daily sync│    │                      │
│ [POST-MVP] Memory    │    │   python:3.11-slim  │    │ [POST-MVP] deny-all  │    │ [POST-MVP] Multi-reg │    │                      │
│ [POST-MVP] Index     │    │ • Multi-stage build  │    │                      │    │ [POST-MVP] Point rec │    │                      │
│ [POST-MVP] Query     │    │ • Layer caching      │    │                      │    │                      │    │                      │
└──────────────────────┘    └──────────────────────┘    └──────────────────────┘    └──────────────────────┘    └──────────────────────┘
                                                                                                                      │
                                                                                                                      │
                                                                                                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    TENANT ISOLATED ENVIRONMENT (nlyzer-tenant-{id} project)                                              │
│                          Service Accounts: nlweb-{tenant}@{project} • [POST-MVP] weaviate-{tenant}@{project}                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────┐    ┌────────────────────────────────┐    ┌────────────────────────────────┐    ┌────────────────────────────────┐
│      NLWEB AI ENGINE           │────│    [POST-MVP] VECTOR DB        │────│    E-COMMERCE INTEGRATION      │────│      ANALYTICS COLLECTION     │
│                                │    │                                │    │                                │    │                                │
│ MVP FastAPI Application:       │    │ [POST-MVP] Weaviate Config     │    │ MVP Platform Connectors:       │    │ MVP Analytics Pipeline:        │
│ • Service: nlweb-{tenant}      │    │ [POST-MVP] Instance weaviate   │    │ • ShopifyConnector.py          │    │ • Event Collection Service     │
│ • URL: {tenant}.nlyzer.com     │    │ [POST-MVP] Port 8080           │    │ [POST-MVP] WooCommerce         │    │ • Basic event streaming        │
│ • Port: 8000                   │    │ [POST-MVP] Memory 8GB          │    │ [POST-MVP] BigCommerce         │    │ • Basic user tracking          │
│ • Replicas: 1-3 (basic scale)  │    │ [POST-MVP] Storage 100GB       │    │ [POST-MVP] Magento             │    │                                │
│                                │    │                                │    │                                │    │ MVP Event Types:               │
│ MVP Core API Endpoints:        │    │ [POST-MVP] Vector Schema       │    │ MVP API Integration:           │    │ • page_view                    │
│ • POST /search/visual          │    │ [POST-MVP] Class Product       │    │ • Shopify GraphQL API v2023-10│    │ • product_search               │
│ • POST /search/text            │    │ [POST-MVP] Properties title    │    │ [POST-MVP] WooCommerce v3      │    │ [POST-MVP] image_upload        │
│ • POST /chat/message           │    │ [POST-MVP] description text    │    │ [POST-MVP] BigCommerce v3      │    │ • chat_interaction             │
│ [POST-MVP] /products/{id}      │    │ [POST-MVP] price number        │    │ [POST-MVP] Magento v1          │    │ [POST-MVP] purchase_intent     │
│ [POST-MVP] /recommendations    │    │ [POST-MVP] category text       │    │                                │    │ [POST-MVP] conversion_event    │
│ • GET /health                  │    │ [POST-MVP] image_url text      │    │ MVP Data Synchronization:      │    │ [POST-MVP] error_event         │
│ [POST-MVP] /metrics            │    │ [POST-MVP] features vector     │    │ • Basic product catalog sync   │    │                                │
│                                │    │ [POST-MVP] availability bool   │    │ [POST-MVP] Inventory updates   │    │ MVP Pub/Sub Integration:       │
│ MVP AI Components:             │    │                                │    │ [POST-MVP] Order processing    │    │ • Topic: analytics-events     │
│ • GPT-4 Vision integration     │    │ [POST-MVP] Vector Operations   │    │ [POST-MVP] Customer data sync  │    │ • Message format: JSON         │
│ • OpenAI Embeddings           │    │ [POST-MVP] Similarity search   │    │                                │    │ [POST-MVP] Batch processing    │
│ • Basic LangChain conversation │    │ [POST-MVP] Hybrid search       │    │ MVP Webhook Handlers:          │    │ [POST-MVP] Dead letter queue   │
│ [POST-MVP] Custom prompts      │    │ [POST-MVP] Filtered search     │    │ • POST /webhooks/shopify       │    │                                │
│ • Intent classification        │    │ [POST-MVP] Aggregation         │    │ [POST-MVP] WooCommerce         │    │ MVP Analytics Schema:          │
│                                │    │                                │    │ [POST-MVP] BigCommerce         │    │ • user_id: string              │
│ MVP Business Logic:            │    │ [POST-MVP] Performance Opt     │    │ [POST-MVP] Magento             │    │ • session_id: string           │
│ • nlyzer/agents/sales.py       │    │ [POST-MVP] Index config        │    │                                │    │ • event_type: enum             │
│ [POST-MVP] support.py          │    │ [POST-MVP] Memory allocation   │    │ MVP Authentication:            │    │ • timestamp: ISO 8601          │
│ [POST-MVP] recommend.py        │    │ [POST-MVP] Query optimization  │    │ • API Key authentication       │    │ • properties: JSON object      │
│ [POST-MVP] conversation.py     │    │ [POST-MVP] Background indexing │    │ [POST-MVP] OAuth 2.0 flows     │    │                                │
│                                │    │                                │    │ [POST-MVP] Webhook signature   │    │ MVP Data Processing:           │
│ MVP Required NLWeb Features:   │    │ [POST-MVP] Backup Strategy     │    │                                │    │ • Real-time aggregation        │
│ • Shopify data ingestion       │    │ [POST-MVP] Daily snapshots     │    │ MVP Error Handling:            │    │ [POST-MVP] Batch hourly        │
│ • Multimodal search (text/voice/image)│ [POST-MVP] Cross-region     │    │ • Rate limiting protection     │    │ [POST-MVP] Data validation     │
│ • Weather API tool integration │    │ [POST-MVP] Point-in-time       │    │ [POST-MVP] API timeout         │    │ [POST-MVP] Schema evolution    │
│ • Add to cart action           │    │ [POST-MVP] Disaster recovery   │    │ [POST-MVP] Retry with backoff  │    │                                │
│ • Begin checkout action        │    │                                │    │ [POST-MVP] Circuit breaker     │    │ MVP BigQuery Integration:      │
│                                │    │ [POST-MVP] Monitoring          │    │                                │    │ • Dataset: tenant_analytics    │
│ MVP Config Management:         │    │ [POST-MVP] Health check        │    │ MVP Data Transformation:       │    │ • Tables: events, sessions     │
│ • Environment: production      │    │ [POST-MVP] Memory usage        │    │ • Basic product normalization  │    │ [POST-MVP] Streaming inserts   │
│ • Config Source: GCS bucket    │    │ [POST-MVP] Query performance   │    │ [POST-MVP] Image processing    │    │ [POST-MVP] Partitioning       │
│ • Secret refs: Secret Manager  │    │ [POST-MVP] Index optimization  │    │ [POST-MVP] Price standard      │    │ [POST-MVP] Retention 2 years   │
│ [POST-MVP] Hot reload          │    │                                │    │ [POST-MVP] Category mapping    │    │                                │
│                                │    │ [POST-MVP] Service Account     │    │                                │    │ MVP Dashboards:                │
│ MVP Security Configuration:    │    │ [POST-MVP] compute.instance    │    │ MVP Service Account IAM:       │    │ • Basic user activity          │
│ • Basic JWT token validation   │    │ [POST-MVP] storage.object      │    │ • secretmanager.secretAccessor │    │ [POST-MVP] Business metrics    │
│ • Rate limiting: 100/min       │    │ [POST-MVP] logging.logWriter   │    │ • logging.logWriter            │    │ [POST-MVP] Performance mon     │
│ • Basic input sanitization     │    │                                │    │ [POST-MVP] monitoring.metric   │    │ [POST-MVP] Error tracking      │
│ [POST-MVP] CORS restrictive    │    │                                │    │                                │    │                                │
└────────────────────────────────┘    └────────────────────────────────┘    └────────────────────────────────┘    └────────────────────────────────┘

```

---

## Part 2: MVP Implementation Sprints ("Lego Instructions")

### Sprint 1: The Secure Foundation (2 weeks)
**Goal:** Build the core API, authentication, and Docker development environment

**Why:** You need a solid backend foundation before any frontend or automation can work. This sprint creates the control plane that everything else depends on.

**Files to Create/Modify:**
```
nlyzer_api/
├── nlyzer/
│   ├── __init__.py
│   ├── main.py                    # FastAPI app entry point
│   ├── core/
│   │   ├── __init__.py
│   │   ├── config.py              # Pydantic settings with basic env vars
│   │   └── security.py            # JWT token generation/validation
│   ├── db/
│   │   ├── __init__.py
│   │   ├── models/
│   │   │   ├── __init__.py
│   │   │   ├── tenant.py          # SQLAlchemy tenant model
│   │   │   ├── user.py            # SQLAlchemy user model
│   │   │   └── billing.py         # SQLAlchemy billing model
│   │   └── crud/
│   │       ├── __init__.py
│   │       ├── tenant.py          # CRUD operations for tenants
│   │       ├── user.py            # CRUD operations for users
│   │       └── billing.py         # CRUD operations for billing
│   └── api/
│       ├── __init__.py
│       └── auth.py                # Authentication endpoints
├── pyproject.toml                 # Poetry dependencies (FastAPI, asyncpg, etc.)
├── Dockerfile                     # Multi-stage Docker build
└── alembic.ini                    # Database migration config

docker-compose.yml                 # PostgreSQL + Redis + API services
.env.example                       # Environment variables template
requirements.txt                   # Pip fallback dependencies
```

**Verification Criteria:**
- [ ] `docker-compose up` starts PostgreSQL, Redis, and FastAPI
- [ ] `POST /api/auth/signup` accepts business data and returns 201
- [ ] Database migrations create tenant/user/billing tables
- [ ] JWT tokens are generated and validated correctly
- [ ] API documentation available at `/docs`

---

### Sprint 2: The Payment Gateway (2 weeks)
**Goal:** Integrate Stripe for subscription payments and webhook processing

**Why:** Payment processing must be bulletproof before any provisioning happens. This sprint ensures revenue capture and subscription management work reliably.

**Files to Create/Modify:**
```
nlyzer_api/nlyzer/
├── integrations/
│   ├── __init__.py
│   └── stripe_client.py           # Stripe API wrapper
├── api/
│   ├── payments.py                # Payment endpoints
│   └── webhooks.py                # Stripe webhook handler
├── agents/
│   ├── __init__.py
│   └── billing.py                 # Subscription management logic
└── core/
    └── config.py                  # Add Stripe environment variables

tests/
├── test_payments.py               # Payment flow tests
└── test_webhooks.py               # Webhook processing tests
```

**Verification Criteria:**
- [ ] `POST /api/payments/create` generates Stripe Payment Intent
- [ ] `POST /api/webhooks/stripe` processes subscription events
- [ ] Webhook signature validation works correctly
- [ ] Database updates tenant status on successful payment
- [ ] Failed payments are handled gracefully
- [ ] Test cards (4242424242424242) work in development

---

### Sprint 3: The Marketing Website Shell (2 weeks)
**Goal:** Build the Next.js marketing site with signup/payment forms

**Why:** Customers need a polished frontend to discover and purchase your service. This sprint creates the customer acquisition funnel.

**Files to Create/Modify:**
```
website/
├── pages/
│   ├── index.tsx                  # Homepage with hero + features
│   ├── pricing.tsx                # Pricing table with plan selection
│   └── signup.tsx                 # Multi-step signup form
├── components/
│   ├── HeroSection.tsx            # Value proposition section
│   ├── FeatureShowcase.tsx        # Key features grid
│   ├── PricingTable.tsx           # Plan comparison table
│   ├── BusinessDetailsForm.tsx    # Company info form
│   ├── EcommercePlatformSelect.tsx # Platform selection dropdown
│   └── PlanSelectionCards.tsx     # Subscription tier cards
├── lib/
│   ├── api.ts                     # API client for backend calls
│   └── stripe.ts                  # Stripe Elements configuration
├── styles/
│   └── globals.css                # TailwindCSS base styles
├── package.json                   # Next.js dependencies
└── tailwind.config.js             # Tailwind configuration

.env.local                         # Next.js environment variables
vercel.json                        # Vercel deployment config
```

**Verification Criteria:**
- [ ] Homepage loads with compelling value proposition
- [ ] Pricing page shows Basic ($99) and Pro ($299) plans
- [ ] Signup form validates business details
- [ ] Form connects to backend API for user creation
- [ ] Stripe Elements integration captures payment
- [ ] Successful payment redirects to "provisioning" page
- [ ] Mobile responsive design works correctly

---

### Sprint 4: The Provisioning Pipeline (2 weeks)
**Goal:** Build the Cloud Function that creates GCP projects and deploys basic NLWeb

**Why:** This is the core automation that delivers value to customers. Without automatic provisioning, you have no scalable business.

**Files to Create/Modify:**
```
cloud_functions/
└── provision_tenant/
    ├── main.py                    # Cloud Function entry point
    ├── provisioning.py            # GCP resource creation logic
    ├── clients.py                 # GCP client management
    ├── exceptions.py              # Custom exception classes
    ├── requirements.txt           # Cloud Function dependencies
    └── nlweb_config_template.yml  # Basic NLWeb configuration

nlyzer_api/nlyzer/
├── api/
│   └── provisioning.py            # Pub/Sub message publishing
└── gcp/
    ├── __init__.py
    ├── dns.py                     # Basic subdomain creation
    └── config_generator.py        # NLWeb config generation

terraform/
├── main.tf                       # GCP project and IAM setup
├── variables.tf                  # Configuration variables
└── outputs.tf                    # Resource outputs
```

**Verification Criteria:**
- [ ] Pub/Sub message triggers Cloud Function
- [ ] Cloud Function creates GCP project with correct naming
- [ ] Service account is created with minimal permissions
- [ ] NLWeb container deploys to Cloud Run successfully
- [ ] Subdomain {tenant}.nlyzer.com resolves to deployment
- [ ] Basic health check endpoint responds correctly
- [ ] Failed provisioning attempts are logged properly

---

### Sprint 5: The "Sales Agent" Configuration (2 weeks)
**Goal:** Configure NLWeb with required sales agent capabilities

**Why:** This sprint delivers on the core MVP promise - a working AI sales agent. Without these features, you have infrastructure but no business value.

**Files to Create/Modify:**
```
nlweb_configs/
├── base_sales_agent.yml           # Base NLWeb configuration
├── shopify_integration.yml        # Shopify data source config
├── tools/
│   ├── weather_api.yml            # Weather API tool configuration
│   ├── add_to_cart.yml            # Shopping cart action
│   └── begin_checkout.yml         # Checkout initiation action
└── prompts/
    ├── sales_agent_system.txt     # System prompt for sales agent
    └── product_recommendation.txt # Product recommendation prompts

cloud_functions/provision_tenant/
├── config_templates/
│   ├── shopify_sales_agent.yml.j2 # Jinja2 template for Shopify
│   └── tools_config.yml.j2       # Tools and actions template
└── config_generator.py           # Enhanced config generation

nlyzer_api/nlyzer/agents/
├── onboarding.py                  # Enhanced tenant setup logic
└── config_validator.py           # Validate NLWeb configurations
```

**Verification Criteria:**
- [ ] Deployed NLWeb instance supports multimodal search (text/voice/image)
- [ ] Shopify product data ingestion works correctly
- [ ] Weather API tool integration functions properly
- [ ] Add to cart action executes successfully
- [ ] Begin checkout action redirects to Shopify checkout
- [ ] Sales agent responds appropriately to customer queries
- [ ] Product recommendations are contextually relevant

---

### Sprint 6: The Data Intelligence Pipeline (2 weeks)
**Goal:** Build analytics collection and basic business intelligence

**Why:** B2B customers need data to justify their investment. This sprint provides the insights that drive customer retention and expansion.

**Files to Create/Modify:**
```
nlyzer_api/nlyzer/
├── analytics/
│   ├── __init__.py
│   ├── collector.py               # Event collection service
│   ├── schemas.py                 # Analytics event schemas
│   └── aggregator.py              # Basic data aggregation
└── api/
    └── analytics.py               # Analytics API endpoints

cloud_functions/
└── analytics_processor/
    ├── main.py                    # Pub/Sub event processor
    ├── bigquery_writer.py         # BigQuery data insertion
    ├── requirements.txt           # Analytics dependencies
    └── event_transformer.py       # Event data transformation

bigquery/
├── schemas/
│   ├── events.json                # Events table schema
│   └── sessions.json              # Sessions table schema
└── views/
    ├── daily_metrics.sql          # Daily aggregation view
    └── tenant_summary.sql         # Tenant performance view

terraform/
├── bigquery.tf                   # BigQuery dataset and tables
└── pubsub.tf                     # Analytics Pub/Sub topics
```

**Verification Criteria:**
- [ ] Customer interactions generate analytics events
- [ ] Events flow through Pub/Sub to BigQuery correctly
- [ ] Daily metrics are calculated and stored
- [ ] API endpoints return basic tenant analytics
- [ ] No PII data is stored in analytics pipeline
- [ ] Event schema validation prevents bad data
- [ ] Analytics data is partitioned by date for performance

---

### Sprint 7: The B2B Dashboard (2 weeks)
**Goal:** Build tenant dashboard with crucial business intelligence

**Why:** The dashboard is what customers see every day. It's the interface that demonstrates value and drives satisfaction.

**Files to Create/Modify:**
```
dashboard/
├── pages/
│   ├── index.tsx                  # Dashboard overview
│   ├── analytics.tsx              # Detailed analytics page
│   ├── settings.tsx               # Tenant configuration
│   └── api/
│       └── [...path].ts           # API proxy to backend
├── components/
│   ├── MetricsCard.tsx            # Key metric display cards
│   ├── AnalyticsChart.tsx         # Chart components
│   ├── UserActivityTable.tsx     # User interaction table
│   ├── SearchPerformance.tsx     # Search analytics
│   └── ConversionFunnel.tsx       # Sales funnel visualization
├── hooks/
│   ├── useAnalytics.ts            # Analytics data fetching
│   └── useTenantData.ts           # Tenant information hook
├── lib/
│   ├── auth.ts                    # Dashboard authentication
│   └── analytics-api.ts           # Analytics API client
└── styles/
    └── dashboard.css              # Dashboard-specific styles

nlyzer_api/nlyzer/api/
├── dashboard.py                   # Dashboard API endpoints
└── reports.py                     # Business intelligence reports
```

**Verification Criteria:**
- [ ] Dashboard shows key metrics (searches, users, conversions)
- [ ] Real-time data updates without page refresh
- [ ] Charts and graphs render customer interaction data
- [ ] Tenant can view and download analytics reports
- [ ] Authentication restricts access to tenant's own data
- [ ] Dashboard is responsive and professional looking
- [ ] Performance is acceptable with typical data volumes

---

### Sprint 8: Final Integration & Testing (2 weeks)
**Goal:** End-to-end testing, polish, and launch preparation

**Why:** This sprint ensures everything works together reliably. It's the difference between a demo and a product customers will pay for.

**Files to Create/Modify:**
```
tests/
├── integration/
│   ├── test_full_signup_flow.py   # Complete customer journey
│   ├── test_provisioning_flow.py # Tenant provisioning test
│   └── test_analytics_pipeline.py # End-to-end analytics test
├── load/
│   ├── test_api_performance.py   # API load testing
│   └── test_nlweb_scaling.py     # NLWeb performance test
└── e2e/
    ├── test_customer_journey.py  # Browser automation tests
    └── test_dashboard_flows.py    # Dashboard user flows

scripts/
├── deploy.sh                     # Production deployment script
├── health_check.sh               # System health validation
├── backup_restore.sh             # Data backup procedures
└── monitoring_setup.sh           # Monitoring configuration

docs/
├── API.md                        # API documentation
├── DEPLOYMENT.md                 # Deployment procedures
├── TROUBLESHOOTING.md            # Common issues and solutions
└── CUSTOMER_ONBOARDING.md        # Customer setup guide
```

**Verification Criteria:**
- [ ] Complete customer journey works end-to-end (signup → payment → provisioning → working AI agent)
- [ ] All critical user flows are covered by automated tests
- [ ] API performance meets acceptable thresholds (< 2s response times)
- [ ] NLWeb instances scale properly under load
- [ ] Error handling provides useful feedback to users
- [ ] Production deployment is repeatable and documented
- [ ] Monitoring and alerting catch critical issues
- [ ] Documentation is complete and accurate

---

## Implementation Notes

### Technical Dependencies
1. **Sprint 1** must complete before any other sprint
2. **Sprint 2** (payments) must complete before **Sprint 4** (provisioning)
3. **Sprint 4** (provisioning) must complete before **Sprint 5** (NLWeb config)
4. **Sprint 6** (analytics) must complete before **Sprint 7** (dashboard)
5. **Sprints 3, 5, 6** can run in parallel after their dependencies

### Risk Mitigation
- **Payments Integration:** Test thoroughly with Stripe test environment
- **GCP Provisioning:** Start with minimal permissions, expand as needed
- **NLWeb Configuration:** Keep configurations simple and well-documented
- **Analytics Pipeline:** Design for scale but implement minimal viable version

### Success Metrics
- **Customer Acquisition:** Functional signup and payment flow
- **Product Delivery:** Working AI sales agent deployed automatically
- **Customer Retention:** Dashboard provides clear business value
- **Business Viability:** End-to-end flow supports paying customers

This plan delivers exactly what you defined as MVP while being ruthless about scope. Everything marked `[POST-MVP]` can be added later as revenue and customer feedback justify the investment.